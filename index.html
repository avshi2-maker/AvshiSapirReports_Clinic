<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×™×•××Ÿ ×¤×¨×•×™×§×˜×™× ××ª×§×“× - × ×™×”×•×œ ××©××‘×™× ×•×¢×œ×•×™×•×ª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 24px;
            background: #f5f5f5;
            border: none;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            position: relative;
        }

        .tab:hover {
            background: #e0e0e0;
        }

        .tab.active {
            background: #667eea;
            color: white;
        }

        .tab .remove-tab {
            margin-right: 8px;
            color: #ff4444;
            font-weight: bold;
            cursor: pointer;
        }

        .tab.active .remove-tab {
            color: #ffcccc;
        }

        .add-project-btn {
            padding: 12px 24px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }

        .add-project-btn:hover {
            background: #45a049;
        }

        .project-content {
            display: none;
        }

        .project-content.active {
            display: block;
        }

        .section {
            background: #f9f9f9;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 2px solid #e0e0e0;
        }

        .section-title {
            font-size: 1.5em;
            color: #667eea;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .resource-management {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .resource-list {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        .resource-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .resource-item input {
            width: 100px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
        }

        .resource-item button {
            padding: 5px 10px;
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .add-resource-form {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .add-resource-form input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }

        .add-resource-form button {
            padding: 10px 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
        }

        .input-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .input-field {
            display: flex;
            flex-direction: column;
        }

        label {
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        input, select, textarea {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn {
            padding: 14px 28px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .email-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            margin-right: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }

        th, td {
            padding: 15px;
            text-align: right;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background: #f5f5f5;
        }

        .delete-btn {
            background: #ff4444;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
        }

        .delete-btn:hover {
            background: #cc0000;
        }

        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .summary-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            border: 2px solid #e0e0e0;
            text-align: center;
        }

        .summary-card h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .summary-value {
            font-size: 2em;
            font-weight: bold;
            color: #333;
        }

        .summary-label {
            color: #666;
            margin-top: 8px;
        }

        .financial-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-top: 30px;
        }

        .financial-summary h2 {
            text-align: center;
            margin-bottom: 25px;
        }

        .financial-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .financial-item {
            text-align: center;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
        }

        .financial-item .label {
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .financial-item .value {
            font-size: 1.8em;
            font-weight: bold;
        }

        .net-profit {
            font-size: 2.2em !important;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .resource-select {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .resource-tag {
            padding: 5px 10px;
            background: #667eea;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .resource-tag:hover {
            background: #764ba2;
        }

        .resource-tag.selected {
            background: #4CAF50;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }
            .container {
                box-shadow: none;
            }
            .btn, .delete-btn, .tabs, .add-resource-form {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š ×™×•××Ÿ ×¤×¨×•×™×§×˜×™× ××ª×§×“×</h1>
        <p class="subtitle">× ×™×”×•×œ ××©××‘×™×, ×¢×œ×•×™×•×ª ×•×¤×¨×•×™×§×˜×™× ××¨×•×‘×™×</p>

        <!-- Tabs for projects -->
        <div class="tabs" id="projectTabs">
            <button class="tab active" data-project="0">
                ×¤×¨×•×™×§×˜ ×¨××©×™
            </button>
            <button class="add-project-btn" onclick="addNewProject()">â• ×¤×¨×•×™×§×˜ ×—×“×©</button>
        </div>

        <!-- Project 0 Content (Default) -->
        <div class="project-content active" id="project-0">
            
            <!-- Resource Management Section -->
            <div class="section">
                <h2 class="section-title">âš™ï¸ × ×™×”×•×œ ××©××‘×™×</h2>
                <div class="resource-management">
                    <div class="resource-list">
                        <h3>×¨×©×™××ª ××©××‘×™× ×–××™× ×™×</h3>
                        <div id="resourceList-0"></div>
                        <div class="add-resource-form">
                            <input type="text" id="newResourceName-0" placeholder="×©× ×”××©××‘">
                            <input type="number" id="newResourceCost-0" placeholder="×¢×œ×•×ª ×™×•××™×ª (â‚ª)" step="0.01">
                            <button onclick="addResource(0)">â• ×”×•×¡×£ ××©××‘</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Entry Form -->
            <div class="section">
                <h2 class="section-title">âœï¸ ×”×•×¡×¤×ª ×¨×©×•××” ×—×“×©×”</h2>
                <div class="input-group">
                    <div class="input-field">
                        <label>×ª××¨×™×š ×”×ª×—×œ×”:</label>
                        <input type="date" id="startDate-0">
                    </div>
                    <div class="input-field">
                        <label>×ª××¨×™×š ×¡×™×•×:</label>
                        <input type="date" id="endDate-0">
                    </div>
                    <div class="input-field">
                        <label>× ×•×©× ×›×œ×œ×™:</label>
                        <input type="text" id="topic-0" placeholder="×ª×™××•×¨ ×”× ×•×©×">
                    </div>
                    <div class="input-field">
                        <label>××¨×›×™×‘ ×©× ×‘× ×”:</label>
                        <input type="text" id="component-0" placeholder="××” × ×‘× ×”?">
                    </div>
                    <div class="input-field">
                        <label>×©×¢×•×ª ×¢×‘×•×“×” ×‘×™×•×:</label>
                        <input type="number" id="hours-0" value="10" min="0" step="0.5">
                    </div>
                    <div class="input-field">
                        <label>×—×™×•×‘ ×©×¢×ª×™ (â‚ª):</label>
                        <input type="number" id="hourlyRate-0" value="0" min="0" step="1">
                    </div>
                </div>
                
                <div class="input-field">
                    <label>×‘×—×¨ ××©××‘×™× ×©×©×™××©×•:</label>
                    <div class="resource-select" id="resourceSelect-0"></div>
                </div>

                <div class="input-field">
                    <label>×”×¢×¨×•×ª:</label>
                    <textarea id="notes-0" placeholder="×”×¢×¨×•×ª × ×•×¡×¤×•×ª ×¢×œ ×”×¨×©×•××”..."></textarea>
                </div>

                <button class="btn" onclick="addEntry(0)">â• ×”×•×¡×£ ×¨×©×•××”</button>
                <button class="btn email-btn" onclick="sendEmail(0)">ğŸ“§ ×©×œ×— ×‘××™×™×œ</button>
                <button class="btn" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);" onclick="printProject(0)">ğŸ–¨ï¸ ×”×“×¤×¡×”</button>
                <button class="btn" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);" onclick="createShareableLink(0)">ğŸ”— ×¦×•×¨ ×§×™×©×•×¨</button>
                <button class="btn" style="background: linear-gradient(135deg, #00c6ff 0%, #0072ff 100%);" onclick="shareToWhatsApp(0)">ğŸ“± ×©×ª×£ ×‘×•×•×˜×¡××¤</button>
                <button class="btn" style="background: linear-gradient(135deg, #f2994a 0%, #f2c94c 100%);" onclick="manualSave(0)">ğŸ’¾ ×©××™×¨×” ×™×“× ×™×ª</button>
                <button class="btn" style="background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%);" onclick="exportForNotebookLM(0)">ğŸ““ ×™×™×¦×•× ×œâ€‘NotebookLM</button>
                
                <div style="margin-top: 15px; display: flex; align-items: center; gap: 10px; background: #f0f0f0; padding: 12px; border-radius: 8px;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin: 0;">
                        <input type="checkbox" id="autoSaveToggle-0" onchange="toggleAutoSave(0)" style="width: 20px; height: 20px; cursor: pointer;">
                        <span style="font-weight: 600;">ğŸ”„ ×©××™×¨×” ××•×˜×•××˜×™×ª (×›×œ 60 ×©× ×™×•×ª)</span>
                    </label>
                    <span id="autoSaveStatus-0" style="margin-right: auto; color: #666; font-size: 0.9em;"></span>
                </div>
            </div>

            <!-- Data Table -->
            <div class="section">
                <h2 class="section-title">ğŸ“‹ ×˜×‘×œ×ª × ×ª×•× ×™×</h2>
                <table id="dataTable-0">
                    <thead>
                        <tr>
                            <th>×ª××¨×™×š ×”×ª×—×œ×”</th>
                            <th>×ª××¨×™×š ×¡×™×•×</th>
                            <th>×™××™ ×¢×‘×•×“×”</th>
                            <th>×¡×”"×› ×©×¢×•×ª</th>
                            <th>× ×•×©× ×›×œ×œ×™</th>
                            <th>××¨×›×™×‘ ×©× ×‘× ×”</th>
                            <th>××©××‘×™× ×©×©×™××©×•</th>
                            <th>×”×¢×¨×•×ª</th>
                            <th>×¢×œ×•×ª ××©××‘×™× (â‚ª)</th>
                            <th>×—×™×•×‘ ×©×¢×ª×™ (â‚ª)</th>
                            <th>×—×™×•×‘ × ×˜×• (â‚ª)</th>
                            <th>×¤×¢×•×œ×•×ª</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <!-- Summary -->
            <div class="summary" id="summary-0">
                <div class="summary-card">
                    <h3>ğŸ“… ×¡×”"×› ×™××™ ×¢×‘×•×“×”</h3>
                    <div class="summary-value" id="totalDays-0">0</div>
                    <div class="summary-label">×™××™×</div>
                </div>
                <div class="summary-card">
                    <h3>â° ×¡×”"×› ×©×¢×•×ª ×¢×‘×•×“×”</h3>
                    <div class="summary-value" id="totalHours-0">0</div>
                    <div class="summary-label">×©×¢×•×ª</div>
                </div>
                <div class="summary-card">
                    <h3>ğŸ’¸ ×¡×”"×› ×¢×œ×•×ª ××©××‘×™×</h3>
                    <div class="summary-value" id="totalResourceCost-0">0</div>
                    <div class="summary-label">â‚ª</div>
                </div>
                <div class="summary-card">
                    <h3>ğŸ’° ×¡×”"×› ×”×›× ×¡×” ×’×•×œ××™×ª</h3>
                    <div class="summary-value" id="totalIncome-0">0</div>
                    <div class="summary-label">â‚ª</div>
                </div>
            </div>

            <!-- Project Planning and Completion -->
            <div class="section">
                <h2 class="section-title">ğŸ“‹ ×ª×•×›× ×™×ª ×œ×¤×™×ª×•×— ×•×”×©×œ××ª ×”×¤×¨×•×™×§×˜</h2>
                
                <div class="input-field" style="margin-bottom: 20px;">
                    <label>×©× ×”×¤×¨×•×™×§×˜:</label>
                    <input type="text" id="planningProjectName-0" placeholder="×©× ×”×¤×¨×•×™×§×˜ ×”××ª×•×›× ×Ÿ">
                </div>

                <!-- Resources Planning -->
                <h3 style="color: #667eea; margin: 20px 0;">âš™ï¸ × ×™×”×•×œ ××©××‘×™× × ×“×¨×©×™×</h3>
                <div class="resource-list">
                    <div id="planningResourceList-0"></div>
                    <div class="add-resource-form">
                        <input type="text" id="planningResourceName-0" placeholder="×©× ×”××©××‘">
                        <input type="number" id="planningResourceCost-0" placeholder="×¢×œ×•×ª ×™×•××™×ª (â‚ª)" step="0.01">
                        <button onclick="addPlanningResource(0)">â• ×”×•×¡×£ ××©××‘</button>
                    </div>
                </div>

                <!-- Planning Summary Table -->
                <h3 style="color: #667eea; margin: 20px 0 10px;">ğŸ“Š ×”×¢×¨×›×•×ª ×•×”×©×œ××ª ×”×¤×¨×•×™×§×˜</h3>
                <div class="input-group" style="margin-bottom: 15px;">
                    <div class="input-field">
                        <label>×¡×”"×› ×™××™ ×¢×‘×•×“×” × ×“×¨×©×™×:</label>
                        <input type="number" id="plannedDays-0" value="0" min="0" step="1" onchange="updatePlanningCalculations(0)">
                    </div>
                    <div class="input-field">
                        <label>×©×¢×•×ª ×¢×‘×•×“×” ×‘×™×•×:</label>
                        <input type="number" id="plannedHoursPerDay-0" value="10" min="0" step="0.5" onchange="updatePlanningCalculations(0)">
                    </div>
                    <div class="input-field">
                        <label>×—×™×•×‘ ×©×¢×ª×™ (â‚ª):</label>
                        <input type="number" id="plannedHourlyRate-0" value="0" min="0" step="1" onchange="updatePlanningCalculations(0)">
                    </div>
                </div>

                <div class="summary" style="margin-top: 20px;">
                    <div class="summary-card">
                        <h3>ğŸ“… ×¡×”"×› ×™××™ ×¢×‘×•×“×”</h3>
                        <div class="summary-value" id="plannedTotalDays-0">0</div>
                        <div class="summary-label">×™××™×</div>
                    </div>
                    <div class="summary-card">
                        <h3>â° ×¡×”"×› ×©×¢×•×ª ×¢×‘×•×“×”</h3>
                        <div class="summary-value" id="plannedTotalHours-0">0</div>
                        <div class="summary-label">×©×¢×•×ª</div>
                    </div>
                    <div class="summary-card">
                        <h3>ğŸ’¸ ×¡×”"×› ××©××‘×™× × ×“×¨×©×™×</h3>
                        <div class="summary-value" id="plannedResourceCost-0">0</div>
                        <div class="summary-label">â‚ª</div>
                    </div>
                    <div class="summary-card">
                        <h3>ğŸ’° ×¡×”"×› ×”×©×§×¢×” × ×“×¨×©×ª</h3>
                        <div class="summary-value" id="plannedTotalCost-0">0</div>
                        <div class="summary-label">â‚ª</div>
                    </div>
                </div>

                <!-- Previous Investments -->
                <h3 style="color: #667eea; margin: 30px 0 10px;">ğŸ’µ ×¢×“×›×•×Ÿ ×¢×œ×•×™×•×ª ×¢×“ ×ª××¨×™×š</h3>
                <div class="input-group">
                    <div class="input-field">
                        <label>×ª××¨×™×š ×¢×“×›×•×Ÿ:</label>
                        <input type="date" id="costUpdateDate-0">
                    </div>
                    <div class="input-field">
                        <label>×¡×›×•× ×¡×•×¤×™ ×©×œ ×“×•×— ×§×•×“× (â‚ª):</label>
                        <input type="number" id="previousReportAmount-0" value="0" step="0.01" onchange="updateInvestmentSummary(0)">
                    </div>
                </div>

                <div class="financial-grid" style="margin-top: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div class="summary-card">
                        <h3>ğŸ’¼ ×¡×”"×› ×”×©×§×¢×•×ª ×§×•×“××•×ª</h3>
                        <div class="summary-value" id="previousInvestments-0">0</div>
                        <div class="summary-label">â‚ª</div>
                    </div>
                    <div class="summary-card">
                        <h3>ğŸš€ ×ª×—×–×™×ª ×”×©×§×¢×” ×—×“×©×”</h3>
                        <div class="summary-value" id="newInvestmentForecast-0">0</div>
                        <div class="summary-label">â‚ª</div>
                    </div>
                    <div class="summary-card" style="border: 3px solid #667eea;">
                        <h3>ğŸ¯ ×¡×”"×› ×›×œ×œ×™ ×”×©×§×¢×”</h3>
                        <div class="summary-value" style="color: #667eea;" id="totalProjectInvestment-0">0</div>
                        <div class="summary-label">×¢×“ ×”×ª×—×œ×ª ×©×™×•×•×§ (â‚ª)</div>
                    </div>
                </div>
            </div>

            <!-- Token Cost Calculator -->
            <div class="section">
                <h2 class="section-title">ğŸ¤– ××—×©×‘×•×Ÿ ×¢×œ×•×™×•×ª ×˜×•×§× ×™× - ×—×™×©×•×‘ ××¤×•×¨×˜</h2>
                
                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 2px solid #ffc107;">
                    <h3 style="color: #856404; margin-bottom: 10px;">âš™ï¸ ×”×’×“×¨×•×ª ×§×‘×•×¢×•×ª</h3>
                    <div class="input-group">
                        <div class="input-field">
                            <label>×˜×•×§× ×™× ×œ×—×™×¤×•×© ×‘××ª×¨ (120 ×©× ×™×•×ª):</label>
                            <input type="number" id="tokensPerSearch-0" value="5000" step="100" onchange="calculateTokenCosts(0)">
                        </div>
                        <div class="input-field">
                            <label>××—×™×¨ ×œ××œ×£ ×˜×•×§× ×™× - Claude API ($):</label>
                            <input type="number" id="tokenPricePer1k-0" value="0.003" step="0.0001" onchange="calculateTokenCosts(0)">
                        </div>
                        <div class="input-field">
                            <label>×©×¢×¨ ×“×•×œ×¨ (â‚ª/$):</label>
                            <input type="number" id="usdToIls-0" value="3.7" step="0.01" onchange="calculateTokenCosts(0)">
                        </div>
                    </div>
                </div>

                <h3 style="color: #667eea; margin: 20px 0;">ğŸ“Š × ×ª×•× ×™ ×©×™××•×©</h3>
                <div class="input-group">
                    <div class="input-field">
                        <label>×›××•×ª ××˜×¤×œ×™ ×“×™×§×•×¨:</label>
                        <input type="number" id="numTherapists-0" value="0" min="0" step="1" onchange="calculateTokenCosts(0)">
                    </div>
                    <div class="input-field">
                        <label>×›××•×ª ×˜×™×¤×•×œ×™× ×™×•××™×ª (×œ×›×œ ××˜×¤×œ):</label>
                        <input type="number" id="treatmentsPerDay-0" value="0" min="0" step="1" onchange="calculateTokenCosts(0)">
                    </div>
                    <div class="input-field">
                        <label>×××•×¦×¢ ×˜×•×§× ×™× ×œ×›×œ ×˜×™×¤×•×œ:</label>
                        <input type="number" id="tokensPerTreatment-0" value="10000" step="100" onchange="calculateTokenCosts(0)">
                    </div>
                    <div class="input-field">
                        <label>×—×™×¤×•×©×™× ×™×•××™×™× ×‘××ª×¨ (×›×œ ××˜×¤×œ×™×):</label>
                        <input type="number" id="dailySearches-0" value="0" min="0" step="1" onchange="calculateTokenCosts(0)">
                    </div>
                    <div class="input-field">
                        <label>×™××™ ×˜×™×¤×•×œ ×—×•×“×©×™×™× ×¦×¤×•×™×™×:</label>
                        <input type="number" id="monthlyWorkDays-0" value="22" min="1" step="1" onchange="calculateTokenCosts(0)">
                    </div>
                </div>

                <h3 style="color: #667eea; margin: 20px 0;">ğŸ’° ×—×™×©×•×‘×™ ×¢×œ×•×™×•×ª</h3>
                <div class="summary">
                    <div class="summary-card">
                        <h3>ğŸ’µ ×¢×œ×•×ª ×˜×•×§× ×™× ×œ×˜×™×¤×•×œ</h3>
                        <div class="summary-value" id="costPerTreatment-0">0</div>
                        <div class="summary-label">â‚ª</div>
                    </div>
                    <div class="summary-card">
                        <h3>ğŸ’µ ×¢×œ×•×ª ×˜×•×§× ×™× ×œ×—×™×¤×•×©</h3>
                        <div class="summary-value" id="costPerSearch-0">0</div>
                        <div class="summary-label">â‚ª</div>
                    </div>
                    <div class="summary-card">
                        <h3>ğŸ“… ×¡×”"×› ×˜×•×§× ×™× ×™×•××™×™×</h3>
                        <div class="summary-value" id="dailyTotalTokens-0">0</div>
                        <div class="summary-label">×˜×•×§× ×™×</div>
                    </div>
                    <div class="summary-card">
                        <h3>ğŸ’¸ ×¢×œ×•×ª ×™×•××™×ª ×›×•×œ×œ×ª</h3>
                        <div class="summary-value" id="dailyTokenCost-0">0</div>
                        <div class="summary-label">â‚ª</div>
                    </div>
                    <div class="summary-card" style="border: 3px solid #667eea;">
                        <h3>ğŸ¯ ×¡×”"×› ×¢×œ×•×ª ×—×•×“×©×™×ª</h3>
                        <div class="summary-value" style="color: #667eea;" id="monthlyTokenCost-0">0</div>
                        <div class="summary-label">â‚ª/×—×•×“×©</div>
                    </div>
                </div>

                <h3 style="color: #667eea; margin: 30px 0 10px;">ğŸ¯ ×”××œ×¦×ª BOT AI - ×›××•×ª ×˜×•×§× ×™× ×œ××˜×¤×œ</h3>
                <div class="input-group" style="margin-bottom: 15px;">
                    <div class="input-field">
                        <label>××—×™×¨ ×× ×•×™ ×—×•×“×©×™ ($):</label>
                        <input type="number" id="subscriptionPriceUsd-0" value="8" step="0.01" onchange="calculateTokenRecommendation(0)">
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 25px; border-radius: 12px; color: white;">
                    <h3 style="text-align: center; margin-bottom: 20px;">ğŸ’¡ ×”××œ×¦×ª ××¢×¨×›×ª</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div style="text-align: center; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                            <div style="font-size: 0.9em; margin-bottom: 10px;">×˜×•×§× ×™× ××•××œ×¦×™× ×œ×—×•×“×©</div>
                            <div style="font-size: 2em; font-weight: bold;" id="recommendedMonthlyTokens-0">0</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                            <div style="font-size: 0.9em; margin-bottom: 10px;">×˜×™×¤×•×œ×™× ××•××œ×¦×™× ×œ×—×•×“×©</div>
                            <div style="font-size: 2em; font-weight: bold;" id="recommendedTreatments-0">0</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                            <div style="font-size: 0.9em; margin-bottom: 10px;">×¨×•×•×— × ×˜×• ××× ×•×™ (â‚ª)</div>
                            <div style="font-size: 2em; font-weight: bold;" id="profitPerSubscriber-0">0</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                            <div style="font-size: 0.9em; margin-bottom: 10px;">××—×•×– ×¨×•×•×— ××× ×•×™</div>
                            <div style="font-size: 2em; font-weight: bold;" id="profitMargin-0">0%</div>
                        </div>
                    </div>
                    <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.2); border-radius: 8px; text-align: center;">
                        <div id="aiRecommendation-0" style="font-size: 1.1em; line-height: 1.6;">
                            ×”×–×Ÿ × ×ª×•× ×™× ×œ×§×‘×œ×ª ×”××œ×¦×” ××•×˜×•××˜×™×ª
                        </div>
                    </div>
                </div>

                <h3 style="color: #667eea; margin: 30px 0 10px;">ğŸ“ˆ ×—×™×©×•×‘ ROI ×œ×œ×§×•×—</h3>
                <div class="input-group">
                    <div class="input-field">
                        <label>×”×•×¦××•×ª ×§×‘×•×¢×•×ª ×—×•×“×©×™×•×ª (â‚ª):</label>
                        <input type="number" id="fixedMonthlyCosts-0" value="0" step="0.01" onchange="calculateClientROI(0)">
                        <small style="color: #666;">×”×¢×ª×§ ×"×¡×”"×› ×¢×œ×•×™×•×ª ×ª×—×–×•×§×” ×—×•×“×©×™×•×ª" ×œ××˜×”</small>
                    </div>
                    <div class="input-field">
                        <label>×¢×œ×•×ª ×˜×•×§× ×™× ×××•×¦×¢×ª (â‚ª/×—×•×“×©):</label>
                        <input type="number" id="avgTokenCostInput-0" value="0" step="0.01" readonly style="background: #f0f0f0;">
                        <small style="color: #666;">××ª×¢×“×›×Ÿ ××•×˜×•××˜×™×ª ××”×—×™×©×•×‘ ×œ××¢×œ×”</small>
                    </div>
                    <div class="input-field">
                        <label>×›××•×ª ×× ×•×™×™× ××©×•×¢×¨×ª:</label>
                        <input type="number" id="estimatedSubscribers-0" value="0" min="0" step="1" onchange="calculateClientROI(0)">
                    </div>
                    <div class="input-field">
                        <label>×”×›× ×¡×” ×—×•×“×©×™×ª ××× ×•×™×™× (â‚ª):</label>
                        <input type="number" id="monthlySubscriptionRevenue-0" value="0" step="0.01" onchange="calculateClientROI(0)">
                    </div>
                </div>

                <div class="financial-summary" style="margin-top: 20px;">
                    <h2>ğŸ’¼ ×“×•×— ROI ×œ×œ×§×•×—</h2>
                    <div class="financial-grid">
                        <div class="financial-item">
                            <div class="label">ğŸ’° ×”×›× ×¡×•×ª ×—×•×“×©×™×•×ª</div>
                            <div class="value" id="roiTotalRevenue-0">0 â‚ª</div>
                        </div>
                        <div class="financial-item">
                            <div class="label">ğŸ’¸ ×”×•×¦××•×ª ×§×‘×•×¢×•×ª</div>
                            <div class="value" id="roiFixedCosts-0">0 â‚ª</div>
                        </div>
                        <div class="financial-item">
                            <div class="label">ğŸ¤– ×¢×œ×•×™×•×ª ×˜×•×§× ×™×</div>
                            <div class="value" id="roiTokenCosts-0">0 â‚ª</div>
                        </div>
                        <div class="financial-item">
                            <div class="label">ğŸ’µ ×¨×•×•×— ×—×•×“×©×™ × ×˜×•</div>
                            <div class="value net-profit" id="roiNetProfit-0">0 â‚ª</div>
                        </div>
                    </div>
                    <div style="margin-top: 20px; padding: 20px; background: rgba(255,255,255,0.2); border-radius: 10px; text-align: center;">
                        <div style="font-size: 1.2em; margin-bottom: 10px;">â±ï¸ ×¦×¤×™ ×”×—×–×¨ ×”×©×§×¢×” ×¨××©×•× ×™×ª</div>
                        <div style="font-size: 2.5em; font-weight: bold;" id="roiPaybackMonths-0">- ×—×•×“×©×™×</div>
                    </div>
                </div>
            </div>

            <!-- Monthly Maintenance Costs -->
            <div class="section">
                <h2 class="section-title">ğŸ”§ ×¢×œ×•×™×•×ª ×§×‘×•×¢×•×ª ×œ×ª×—×–×•×§×ª ×”××ª×¨ - ×§×œ×™× ×™×§×” ×œ×“×™×§×•×¨</h2>
                
                <div class="input-group" style="margin-bottom: 20px;">
                    <div class="input-field">
                        <label>××™×—×¡×•×Ÿ ×”××ª×¨ (â‚ª/×—×•×“×©):</label>
                        <input type="number" id="hostingCost-0" value="0" step="0.01" onchange="updateMaintenanceCosts(0)">
                    </div>
                    <div class="input-field">
                        <label>×¢×œ×•×ª ×××•×¦×¢×ª ×©×œ ×˜×•×§× ×™× (â‚ª/×—×•×“×©):</label>
                        <input type="number" id="tokenCost-0" value="0" step="0.01" onchange="updateMaintenanceCosts(0)">
                    </div>
                    <div class="input-field">
                        <label>×©×¢×•×ª ×ª×—×–×•×§×” (×©×¢×•×ª/×—×•×“×©):</label>
                        <input type="number" id="maintenanceHours-0" value="0" step="0.5" onchange="updateMaintenanceCosts(0)">
                    </div>
                    <div class="input-field">
                        <label>×ª×¢×¨×™×£ ×©×¢×ª×™ ××ª×›× ×ª (â‚ª/×©×¢×”):</label>
                        <input type="number" id="programmerRate-0" value="0" step="1" onchange="updateMaintenanceCosts(0)">
                    </div>
                    <div class="input-field">
                        <label>×¢××œ×•×ª ×’×‘×™×™×ª ×ª×©×œ×•××™× (â‚ª/×—×•×“×©):</label>
                        <input type="number" id="paymentFees-0" value="0" step="0.01" onchange="updateMaintenanceCosts(0)">
                    </div>
                    <div class="input-field">
                        <label>×”×•×¦××•×ª ×©×•× ×•×ª (â‚ª/×—×•×“×©):</label>
                        <input type="number" id="otherFixedCosts-0" value="0" step="0.01" onchange="updateMaintenanceCosts(0)">
                    </div>
                </div>

                <h3 style="color: #667eea; margin: 20px 0;">ğŸ› ï¸ ×ª×•×›× ×•×ª ×œ×ª×—×–×•×§×”</h3>
                <div id="softwareList-0" style="margin-bottom: 15px;"></div>
                <div class="add-resource-form">
                    <input type="text" id="softwareName-0" placeholder="×©× ×”×ª×•×›× ×”">
                    <input type="number" id="softwareCost-0" placeholder="×¢×œ×•×ª ×—×•×“×©×™×ª (â‚ª)" step="0.01">
                    <button onclick="addSoftware(0)">â• ×”×•×¡×£ ×ª×•×›× ×”</button>
                </div>

                <h3 style="color: #667eea; margin: 20px 0;">ğŸ“ ×¢×œ×•×™×•×ª ×©×•× ×•×ª</h3>
                <div id="miscCostsList-0" style="margin-bottom: 15px;"></div>
                <div class="add-resource-form">
                    <input type="text" id="miscCostName-0" placeholder="×ª×™××•×¨ ×”×¢×œ×•×ª">
                    <input type="number" id="miscCostAmount-0" placeholder="×¡×›×•× (â‚ª)" step="0.01">
                    <button onclick="addMiscCost(0)">â• ×”×•×¡×£ ×¢×œ×•×ª</button>
                </div>

                <div class="summary-card" style="margin-top: 20px; background: #fff3cd; border: 2px solid #ffc107;">
                    <h3 style="color: #856404;">ğŸ’° ×¡×”"×› ×¢×œ×•×™×•×ª ×ª×—×–×•×§×” ×—×•×“×©×™×•×ª</h3>
                    <div class="summary-value" style="color: #856404;" id="totalMonthlyCosts-0">0</div>
                    <div class="summary-label">â‚ª ×œ×—×•×“×©</div>
                </div>
            </div>

            <!-- Revenue Forecast -->
            <div class="section">
                <h2 class="section-title">ğŸ“ˆ ×ª×—×–×™×ª ×”×›× ×¡×•×ª ×—×•×“×©×™×ª</h2>
                
                <div class="input-group">
                    <div class="input-field">
                        <label>×›××•×ª ×× ×•×™×™× ×—×•×“×©×™×ª:</label>
                        <input type="number" id="monthlySubscribers-0" value="0" min="0" step="1" onchange="updateRevenueCalculations(0)">
                    </div>
                    <div class="input-field">
                        <label>××—×™×¨ ×× ×•×™ ×—×•×“×©×™ (â‚ª):</label>
                        <input type="number" id="subscriptionPrice-0" value="0" min="0" step="0.01" onchange="updateRevenueCalculations(0)">
                    </div>
                    <div class="input-field">
                        <label>×”×›× ×¡×•×ª × ×•×¡×¤×•×ª (â‚ª/×—×•×“×©):</label>
                        <input type="number" id="additionalRevenue-0" value="0" min="0" step="0.01" onchange="updateRevenueCalculations(0)">
                    </div>
                </div>

                <div class="summary-card" style="margin-top: 20px; background: #d4edda; border: 2px solid #28a745;">
                    <h3 style="color: #155724;">ğŸ’µ ×¡×”"×› ×”×›× ×¡×” ×—×•×“×©×™×ª ×¦×¤×•×™×”</h3>
                    <div class="summary-value" style="color: #155724;" id="totalMonthlyRevenue-0">0</div>
                    <div class="summary-label">â‚ª ×œ×—×•×“×©</div>
                </div>
            </div>

            <!-- Final Profit/Loss Report -->
            <div class="financial-summary">
                <h2>ğŸ“Š ×“×•×— ××¡×›× ×¡×•×¤×™ - ×¨×•×•×—/×”×¤×¡×“ ×—×•×“×©×™</h2>
                <div class="financial-grid">
                    <div class="financial-item">
                        <div class="label">ğŸ’° ×”×›× ×¡×•×ª ×—×•×“×©×™×•×ª</div>
                        <div class="value" id="finalMonthlyRevenue-0">0 â‚ª</div>
                    </div>
                    <div class="financial-item">
                        <div class="label">ğŸ’¸ ×”×•×¦××•×ª ×ª×—×–×•×§×”</div>
                        <div class="value" id="finalMonthlyCosts-0">0 â‚ª</div>
                    </div>
                    <div class="financial-item">
                        <div class="label" id="profitLossLabel-0">ğŸ’µ ×¨×•×•×— ×—×•×“×©×™</div>
                        <div class="value net-profit" id="monthlyProfitLoss-0">0 â‚ª</div>
                    </div>
                    <div class="financial-item">
                        <div class="label">â±ï¸ ×–××Ÿ ×”×—×–×¨ ×”×©×§×¢×”</div>
                        <div class="value" id="roiMonths-0">- ×—×•×“×©×™×</div>
                    </div>
                </div>

                <div style="margin-top: 30px; padding: 20px; background: rgba(255,255,255,0.2); border-radius: 10px;">
                    <h3 style="text-align: center; margin-bottom: 15px;">ğŸ¯ ×”××œ×¦×” ×œ××™× ×™××•× ×× ×•×™×™×</h3>
                    <div style="text-align: center; font-size: 1.2em; margin-bottom: 10px;">
                        <strong>××™× ×™××•× ×× ×•×™×™× ×œ×™×¦×™×¨×ª ×¨×•×•×— ×—×•×“×©×™:</strong>
                    </div>
                    <div style="text-align: center; font-size: 2.5em; font-weight: bold;" id="minSubscribersRecommendation-0">0</div>
                    <div style="text-align: center; margin-top: 10px; font-size: 0.9em; opacity: 0.9;">
                        * ×—×™×©×•×‘ ××‘×•×¡×¡ ×¢×œ ×¢×œ×•×™×•×ª ×ª×—×–×•×§×” ×—×•×“×©×™×•×ª ××•×œ ××—×™×¨ ×× ×•×™
                    </div>
                </div>
            </div>

            <!-- Financial Summary -->
            <div class="financial-summary">
                <h2>ğŸ’° ×¡×™×›×•× ×¤×™× × ×¡×™ ×¡×•×¤×™</h2>
                <div class="financial-grid">
                    <div class="financial-item">
                        <div class="label">×”×›× ×¡×” ×‘×¨×•×˜×•</div>
                        <div class="value" id="grossIncome-0">0 â‚ª</div>
                    </div>
                    <div class="financial-item">
                        <div class="label">×¢×œ×•×™×•×ª ××©××‘×™×</div>
                        <div class="value" id="resourceCosts-0">0 â‚ª</div>
                    </div>
                    <div class="financial-item">
                        <div class="label">ğŸ’µ ×”×›× ×¡×” × ×˜×• (×¨×•×•×— × ×§×™)</div>
                        <div class="value net-profit" id="netProfit-0">0 â‚ª</div>
                    </div>
                    <div class="financial-item">
                        <div class="label">×©×›×¨ ×©×¢×ª×™ ×××•×¦×¢ × ×˜×•</div>
                        <div class="value" id="avgHourlyRate-0">0 â‚ª/×©×¢×”</div>
                    </div>
                </div>

                <!-- Payment Tracking -->
                <div class="payment-section" style="margin-top: 30px;">
                    <h3 style="text-align: center; margin-bottom: 20px;">ğŸ’³ ××¢×§×‘ ×ª×©×œ×•××™×</h3>
                    <div class="payment-form" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px;">×ª××¨×™×š ×—×™×•×‘:</label>
                            <input type="date" id="invoiceDate-0" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px;">×¡×›×•× ×—×™×•×‘ (â‚ª):</label>
                            <input type="number" id="invoiceAmount-0" step="0.01" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px;">×ª××¨×™×š ×ª×©×œ×•×:</label>
                            <input type="date" id="paymentDate-0" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px;">×¡×›×•× ×”×ª×§×‘×œ (â‚ª):</label>
                            <input type="number" id="paymentAmount-0" step="0.01" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white;">
                        </div>
                        <div style="grid-column: 1 / -1;">
                            <label style="display: block; margin-bottom: 5px;">×”×¢×¨×•×ª ×ª×©×œ×•×:</label>
                            <input type="text" id="paymentNotes-0" placeholder="×”×¢×¨×•×ª ×¢×œ ×”×—×™×•×‘/×ª×©×œ×•×" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white;">
                        </div>
                    </div>
                    <button onclick="addPaymentRecord(0)" style="padding: 10px 20px; background: white; color: #667eea; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%;">â• ×”×•×¡×£ ×¨×©×•××ª ×ª×©×œ×•×</button>
                    
                    <div id="paymentRecords-0" style="margin-top: 20px;"></div>
                    
                    <div style="margin-top: 20px; padding: 20px; background: rgba(255,255,255,0.2); border-radius: 10px; text-align: center;">
                        <div style="font-size: 1.2em; margin-bottom: 10px;">ğŸ’° ×™×ª×¨×” ×œ×ª×©×œ×•×</div>
                        <div style="font-size: 2.5em; font-weight: bold;" id="balanceDue-0">0 â‚ª</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Report History Section -->
        <div class="section" style="margin-top: 30px;">
            <h2 class="section-title">ğŸ“ ×”×™×¡×˜×•×¨×™×™×ª ×“×•×—×•×ª ×©× ×©××¨×•</h2>
            <table id="reportHistoryTable">
                <thead>
                    <tr>
                        <th>×©× ×§×•×‘×¥</th>
                        <th>×ª××¨×™×š ×•×©×¢×”</th>
                        <th>×¤×¢×•×œ×•×ª</th>
                    </tr>
                </thead>
                <tbody id="reportHistoryBody"></tbody>
            </table>
            <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="btn" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);" onclick="loadReportFromFile()">ğŸ“‚ ×˜×¢×Ÿ ×“×•×— ××§×•×‘×¥ JSON</button>
            </div>
        </div>
    </div>

    <script>
        // Global data structure
        let projects = {
            0: {
                name: '×¤×¨×•×™×§×˜ ×¨××©×™',
                resources: {
                    'CLAUDE': 10,
                    'CHATGPT': 8,
                    'PERPLEXITY': 5
                },
                entries: [],
                payments: [],
                planningResources: {},
                softwareList: [],
                miscCosts: []
            }
        };
        let projectCounter = 1;
        let currentProject = 0;
        let autoSaveIntervals = {};
        let savedReports = JSON.parse(localStorage.getItem('savedReports') || '[]');

        // Initialize on load
        window.onload = function() {
            initializeProject(0);
            loadFromLocalStorage();
            loadProjectFromUrl();
            renderReportHistory();
        };

        function initializeProject(projectId) {
            updateResourceList(projectId);
            updateResourceSelect(projectId);
            renderTable(projectId);
            updateSummary(projectId);
            updatePlanningResourceList(projectId);
            renderSoftwareList(projectId);
            renderMiscCosts(projectId);
            updatePlanningCalculations(projectId);
            updateMaintenanceCosts(projectId);
            updateRevenueCalculations(projectId);
        }

        function addNewProject() {
            const projectName = prompt('×”×›× ×¡ ×©× ×œ×¤×¨×•×™×§×˜ ×”×—×“×©:', `×¤×¨×•×™×§×˜ ${projectCounter + 1}`);
            if (!projectName) return;

            const newProjectId = projectCounter++;
            projects[newProjectId] = {
                name: projectName,
                resources: { ...projects[0].resources },
                entries: [],
                payments: [],
                planningResources: {},
                softwareList: [],
                miscCosts: []
            };

            // Add tab
            const tabsContainer = document.getElementById('projectTabs');
            const addBtn = tabsContainer.querySelector('.add-project-btn');
            const newTab = document.createElement('button');
            newTab.className = 'tab';
            newTab.dataset.project = newProjectId;
            newTab.innerHTML = `<span class="remove-tab" onclick="removeProject(${newProjectId}, event)">âœ–</span>${projectName}`;
            newTab.onclick = function() { switchProject(newProjectId); };
            tabsContainer.insertBefore(newTab, addBtn);

            // Create project content
            const mainContainer = document.querySelector('.container');
            const projectContent = document.querySelector('.project-content').cloneNode(true);
            projectContent.id = `project-${newProjectId}`;
            projectContent.className = 'project-content';
            
            // Update all IDs in cloned content
            projectContent.innerHTML = projectContent.innerHTML.replace(/\-0/g, `-${newProjectId}`);
            mainContainer.appendChild(projectContent);

            initializeProject(newProjectId);
            switchProject(newProjectId);
            saveToLocalStorage();
        }

        function removeProject(projectId, event) {
            event.stopPropagation();
            if (projectId === 0) {
                alert('×œ× × ×™×ª×Ÿ ×œ××—×•×§ ××ª ×”×¤×¨×•×™×§×˜ ×”×¨××©×™');
                return;
            }
            if (!confirm(`×”×× ×œ××—×•×§ ××ª ×”×¤×¨×•×™×§×˜ "${projects[projectId].name}"?`)) return;

            delete projects[projectId];
            document.querySelector(`[data-project="${projectId}"]`).remove();
            document.getElementById(`project-${projectId}`).remove();
            
            if (currentProject === projectId) {
                switchProject(0);
            }
            saveToLocalStorage();
        }

        function switchProject(projectId) {
            currentProject = projectId;
            
            // Update tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.project == projectId);
            });

            // Update content
            document.querySelectorAll('.project-content').forEach(content => {
                content.classList.toggle('active', content.id === `project-${projectId}`);
            });
        }

        function addResource(projectId) {
            const nameInput = document.getElementById(`newResourceName-${projectId}`);
            const costInput = document.getElementById(`newResourceCost-${projectId}`);
            
            const name = nameInput.value.trim();
            const cost = parseFloat(costInput.value);

            if (!name || isNaN(cost) || cost < 0) {
                alert('× × ×œ××œ× ×©× ××©××‘ ×•×¢×œ×•×ª ×ª×§×™× ×”');
                return;
            }

            projects[projectId].resources[name] = cost;
            nameInput.value = '';
            costInput.value = '';
            
            updateResourceList(projectId);
            updateResourceSelect(projectId);
            saveToLocalStorage();
        }

        function updateResourceCost(projectId, resourceName, newCost) {
            projects[projectId].resources[resourceName] = parseFloat(newCost);
            updateResourceSelect(projectId);
            renderTable(projectId);
            updateSummary(projectId);
            saveToLocalStorage();
        }

        function removeResource(projectId, resourceName) {
            if (confirm(`×”×× ×œ××—×•×§ ××ª ×”××©××‘ "${resourceName}"?`)) {
                delete projects[projectId].resources[resourceName];
                updateResourceList(projectId);
                updateResourceSelect(projectId);
                saveToLocalStorage();
            }
        }

        function updateResourceList(projectId) {
            const container = document.getElementById(`resourceList-${projectId}`);
            container.innerHTML = '';
            
            for (const [name, cost] of Object.entries(projects[projectId].resources)) {
                const div = document.createElement('div');
                div.className = 'resource-item';
                div.innerHTML = `
                    <strong>${name}</strong>
                    <div>
                        <input type="number" value="${cost}" step="0.01" 
                               onchange="updateResourceCost(${projectId}, '${name}', this.value)">
                        <span> â‚ª/×™×•×</span>
                        <button onclick="removeResource(${projectId}, '${name}')">ğŸ—‘ï¸</button>
                    </div>
                `;
                container.appendChild(div);
            }
        }

        function updateResourceSelect(projectId) {
            const container = document.getElementById(`resourceSelect-${projectId}`);
            container.innerHTML = '';
            
            for (const [name, cost] of Object.entries(projects[projectId].resources)) {
                const tag = document.createElement('div');
                tag.className = 'resource-tag';
                tag.textContent = `${name} (${cost} â‚ª/×™×•×)`;
                tag.onclick = function() { this.classList.toggle('selected'); };
                container.appendChild(tag);
            }
        }

        function getSelectedResources(projectId) {
            const selected = [];
            document.querySelectorAll(`#resourceSelect-${projectId} .resource-tag.selected`).forEach(tag => {
                const name = tag.textContent.split(' (')[0];
                selected.push(name);
            });
            return selected;
        }

        function calculateDaysBetweenDates(startDate, endDate) {
            const start = new Date(startDate);
            const end = new Date(endDate);
            const diffTime = Math.abs(end - start);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1; // +1 to include both start and end dates
            return diffDays;
        }

        function addEntry(projectId) {
            const startDate = document.getElementById(`startDate-${projectId}`).value;
            const endDate = document.getElementById(`endDate-${projectId}`).value;
            const topic = document.getElementById(`topic-${projectId}`).value;
            const component = document.getElementById(`component-${projectId}`).value;
            const hoursPerDay = parseFloat(document.getElementById(`hours-${projectId}`).value);
            const hourlyRate = parseFloat(document.getElementById(`hourlyRate-${projectId}`).value);
            const notes = document.getElementById(`notes-${projectId}`).value;
            const selectedResources = getSelectedResources(projectId);

            if (!startDate || !endDate || !topic || !component) {
                alert('× × ×œ××œ× ××ª ×›×œ ×”×©×“×•×ª ×”×—×•×‘×”');
                return;
            }

            const workDays = calculateDaysBetweenDates(startDate, endDate);
            const totalHours = workDays * hoursPerDay;

            let resourceCost = 0;
            selectedResources.forEach(resourceName => {
                resourceCost += (projects[projectId].resources[resourceName] || 0) * workDays;
            });

            const grossCharge = totalHours * hourlyRate;
            const netCharge = grossCharge - resourceCost;

            const entry = {
                startDate,
                endDate,
                workDays,
                totalHours,
                topic,
                component,
                resources: selectedResources,
                notes,
                resourceCost,
                hourlyRate,
                grossCharge,
                netCharge
            };

            projects[projectId].entries.push(entry);
            
            // Clear form
            document.getElementById(`startDate-${projectId}`).value = '';
            document.getElementById(`endDate-${projectId}`).value = '';
            document.getElementById(`topic-${projectId}`).value = '';
            document.getElementById(`component-${projectId}`).value = '';
            document.getElementById(`notes-${projectId}`).value = '';
            document.querySelectorAll(`#resourceSelect-${projectId} .resource-tag`).forEach(tag => {
                tag.classList.remove('selected');
            });

            renderTable(projectId);
            updateSummary(projectId);
            saveToLocalStorage();
        }

        function deleteEntry(projectId, index) {
            if (confirm('×”×× ×œ××—×•×§ ×¨×©×•××” ×–×•?')) {
                projects[projectId].entries.splice(index, 1);
                renderTable(projectId);
                updateSummary(projectId);
                saveToLocalStorage();
            }
        }

        function renderTable(projectId) {
            const tbody = document.querySelector(`#dataTable-${projectId} tbody`);
            tbody.innerHTML = '';

            projects[projectId].entries.forEach((entry, index) => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${entry.startDate}</td>
                    <td>${entry.endDate}</td>
                    <td>${entry.workDays}</td>
                    <td>${entry.totalHours}</td>
                    <td>${entry.topic}</td>
                    <td>${entry.component}</td>
                    <td>${entry.resources.join(', ')}</td>
                    <td>${entry.notes || '-'}</td>
                    <td>${entry.resourceCost.toFixed(2)}</td>
                    <td>${entry.hourlyRate.toFixed(2)}</td>
                    <td>${entry.netCharge.toFixed(2)}</td>
                    <td><button class="delete-btn" onclick="deleteEntry(${projectId}, ${index})">ğŸ—‘ï¸ ××—×§</button></td>
                `;
            });
        }

        function updateSummary(projectId) {
            let totalDays = 0;
            let totalHours = 0;
            let totalResourceCost = 0;
            let totalGrossIncome = 0;

            projects[projectId].entries.forEach(entry => {
                totalDays += entry.workDays;
                totalHours += entry.totalHours;
                totalResourceCost += entry.resourceCost;
                totalGrossIncome += entry.grossCharge;
            });

            const netProfit = totalGrossIncome - totalResourceCost;
            const avgHourlyRate = totalHours > 0 ? netProfit / totalHours : 0;

            document.getElementById(`totalDays-${projectId}`).textContent = totalDays;
            document.getElementById(`totalHours-${projectId}`).textContent = totalHours;
            document.getElementById(`totalResourceCost-${projectId}`).textContent = totalResourceCost.toFixed(2);
            document.getElementById(`totalIncome-${projectId}`).textContent = totalGrossIncome.toFixed(2);
            
            document.getElementById(`grossIncome-${projectId}`).textContent = totalGrossIncome.toFixed(2) + ' â‚ª';
            document.getElementById(`resourceCosts-${projectId}`).textContent = totalResourceCost.toFixed(2) + ' â‚ª';
            document.getElementById(`netProfit-${projectId}`).textContent = netProfit.toFixed(2) + ' â‚ª';
            document.getElementById(`avgHourlyRate-${projectId}`).textContent = avgHourlyRate.toFixed(2) + ' â‚ª/×©×¢×”';
            
            updatePaymentBalance(projectId);
        }

        function addPaymentRecord(projectId) {
            const invoiceDate = document.getElementById(`invoiceDate-${projectId}`).value;
            const invoiceAmount = parseFloat(document.getElementById(`invoiceAmount-${projectId}`).value) || 0;
            const paymentDate = document.getElementById(`paymentDate-${projectId}`).value;
            const paymentAmount = parseFloat(document.getElementById(`paymentAmount-${projectId}`).value) || 0;
            const paymentNotes = document.getElementById(`paymentNotes-${projectId}`).value;

            if (!invoiceDate && !paymentDate) {
                alert('× × ×œ××œ× ×œ×¤×—×•×ª ×ª××¨×™×š ××—×“');
                return;
            }

            const record = {
                invoiceDate,
                invoiceAmount,
                paymentDate,
                paymentAmount,
                notes: paymentNotes
            };

            projects[projectId].payments.push(record);

            // Clear form
            document.getElementById(`invoiceDate-${projectId}`).value = '';
            document.getElementById(`invoiceAmount-${projectId}`).value = '';
            document.getElementById(`paymentDate-${projectId}`).value = '';
            document.getElementById(`paymentAmount-${projectId}`).value = '';
            document.getElementById(`paymentNotes-${projectId}`).value = '';

            renderPaymentRecords(projectId);
            updatePaymentBalance(projectId);
            saveToLocalStorage();
        }

        function renderPaymentRecords(projectId) {
            const container = document.getElementById(`paymentRecords-${projectId}`);
            container.innerHTML = '';

            projects[projectId].payments.forEach((record, index) => {
                const div = document.createElement('div');
                div.style.cssText = 'background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin-bottom: 10px;';
                div.innerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                        ${record.invoiceDate ? `<div><strong>ğŸ“… ×ª××¨×™×š ×—×™×•×‘:</strong> ${record.invoiceDate}</div>` : ''}
                        ${record.invoiceAmount ? `<div><strong>ğŸ’µ ×¡×›×•× ×—×™×•×‘:</strong> ${record.invoiceAmount.toFixed(2)} â‚ª</div>` : ''}
                        ${record.paymentDate ? `<div><strong>ğŸ“… ×ª××¨×™×š ×ª×©×œ×•×:</strong> ${record.paymentDate}</div>` : ''}
                        ${record.paymentAmount ? `<div><strong>âœ… ×¡×›×•× ×”×ª×§×‘×œ:</strong> ${record.paymentAmount.toFixed(2)} â‚ª</div>` : ''}
                    </div>
                    ${record.notes ? `<div style="margin-top: 10px;"><strong>ğŸ“ ×”×¢×¨×•×ª:</strong> ${record.notes}</div>` : ''}
                    <button onclick="deletePaymentRecord(${projectId}, ${index})" style="margin-top: 10px; padding: 5px 15px; background: #ff4444; color: white; border: none; border-radius: 5px; cursor: pointer;">ğŸ—‘ï¸ ××—×§</button>
                `;
                container.appendChild(div);
            });
        }

        function deletePaymentRecord(projectId, index) {
            if (confirm('×”×× ×œ××—×•×§ ×¨×©×•××ª ×ª×©×œ×•× ×–×•?')) {
                projects[projectId].payments.splice(index, 1);
                renderPaymentRecords(projectId);
                updatePaymentBalance(projectId);
                saveToLocalStorage();
            }
        }

        function updatePaymentBalance(projectId) {
            let totalInvoiced = 0;
            let totalReceived = 0;

            projects[projectId].payments.forEach(record => {
                totalInvoiced += record.invoiceAmount || 0;
                totalReceived += record.paymentAmount || 0;
            });

            const balance = totalInvoiced - totalReceived;
            document.getElementById(`balanceDue-${projectId}`).textContent = balance.toFixed(2) + ' â‚ª';
        }

        function printProject(projectId) {
            window.print();
        }

        function createShareableLink(projectId) {
            const projectName = projects[projectId].name;
            const projectData = JSON.stringify(projects[projectId]);
            const encodedData = btoa(encodeURIComponent(projectData));
            
            const baseUrl = window.location.href.split('?')[0];
            const shareUrl = `${baseUrl}?project=${encodedData}`;
            
            // Create a temporary input to copy the URL
            const tempInput = document.createElement('input');
            tempInput.value = shareUrl;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);
            
            alert(`×§×™×©×•×¨ ×œ×©×™×ª×•×£ ×”×¤×¨×•×™×§×˜ "${projectName}" ×”×•×¢×ª×§ ×œ×œ×•×—!\n\n× ×™×ª×Ÿ ×œ×©×œ×•×— ××•×ª×• ×œ××™×©×”×• ×•×”× ×ª×•× ×™× ×™×™×˜×¢× ×• ××•×˜×•××˜×™×ª.`);
        }

        function shareToWhatsApp(projectId) {
            const projectName = projects[projectId].name;
            const projectData = JSON.stringify(projects[projectId]);
            const encodedData = btoa(encodeURIComponent(projectData));
            
            const baseUrl = window.location.href.split('?')[0];
            const shareUrl = `${baseUrl}?project=${encodedData}`;
            
            const message = `×”×™×™! ×× ×™ ××©×ª×£/×ª ××™×ª×š ××ª ×”×¤×¨×•×™×§×˜ "${projectName}" ğŸ“Š\n\n×œ×—×¥/×™ ×¢×œ ×”×§×™×©×•×¨ ×œ×¦×¤×™×™×”:\n${shareUrl}`;
            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
            
            window.open(whatsappUrl, '_blank');
        }

        function manualSave(projectId) {
            const projectName = projects[projectId].name;
            const now = new Date();
            const timestamp = now.getFullYear() + '-' + 
                            String(now.getMonth() + 1).padStart(2, '0') + '-' + 
                            String(now.getDate()).padStart(2, '0') + '_' + 
                            String(now.getHours()).padStart(2, '0') + '-' + 
                            String(now.getMinutes()).padStart(2, '0') + '-' + 
                            String(now.getSeconds()).padStart(2, '0');
            
            const fileName = `${projectName.replace(/\s+/g, '_')}_${timestamp}.json`;
            const dataStr = JSON.stringify(projects[projectId], null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            a.click();
            URL.revokeObjectURL(url);
            
            addReportToHistory(fileName);
            alert(`×”×¤×¨×•×™×§×˜ × ×©××¨ ×‘×”×¦×œ×—×”!\n×©× ×”×§×•×‘×¥: ${fileName}`);
        }

        function toggleAutoSave(projectId) {
            const checkbox = document.getElementById(`autoSaveToggle-${projectId}`);
            const statusEl = document.getElementById(`autoSaveStatus-${projectId}`);
            
            if (checkbox.checked) {
                // Start auto-save
                autoSaveIntervals[projectId] = setInterval(() => {
                    autoSaveProject(projectId);
                }, 60000); // 60 seconds
                
                statusEl.textContent = 'âœ… ×¤×¢×™×œ - ×©××™×¨×” ×›×œ 60 ×©× ×™×•×ª';
                statusEl.style.color = '#4CAF50';
                
                alert('×©××™×¨×” ××•×˜×•××˜×™×ª ×”×•×¤×¢×œ×”! ×”×¤×¨×•×™×§×˜ ×™×™×©××¨ ××•×˜×•××˜×™×ª ×›×œ 60 ×©× ×™×•×ª.');
            } else {
                // Stop auto-save
                if (autoSaveIntervals[projectId]) {
                    clearInterval(autoSaveIntervals[projectId]);
                    delete autoSaveIntervals[projectId];
                }
                
                statusEl.textContent = 'â¸ï¸ ××•×©×‘×ª';
                statusEl.style.color = '#666';
            }
        }

        function autoSaveProject(projectId) {
            const projectName = projects[projectId].name;
            const now = new Date();
            const timestamp = now.getFullYear() + '-' + 
                            String(now.getMonth() + 1).padStart(2, '0') + '-' + 
                            String(now.getDate()).padStart(2, '0') + '_' + 
                            String(now.getHours()).padStart(2, '0') + '-' + 
                            String(now.getMinutes()).padStart(2, '0') + '-' + 
                            String(now.getSeconds()).padStart(2, '0');
            
            const fileName = `${projectName.replace(/\s+/g, '_')}_autosave_${timestamp}.json`;
            const dataStr = JSON.stringify(projects[projectId], null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            a.click();
            URL.revokeObjectURL(url);
            
            addReportToHistory(fileName);

            // Update status
            const statusEl = document.getElementById(`autoSaveStatus-${projectId}`);
            if (statusEl) {
                const timeStr = String(now.getHours()).padStart(2, '0') + ':' + 
                               String(now.getMinutes()).padStart(2, '0');
                statusEl.textContent = `âœ… ×©××™×¨×” ××—×¨×•× ×”: ${timeStr}`;
            }
        }

        function loadProjectFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            const projectData = urlParams.get('project');
            
            if (projectData) {
                try {
                    const decodedData = decodeURIComponent(atob(projectData));
                    const project = JSON.parse(decodedData);
                    
                    const newProjectId = projectCounter++;
                    projects[newProjectId] = project;
                    
                    // Add tab and content
                    const tabsContainer = document.getElementById('projectTabs');
                    const addBtn = tabsContainer.querySelector('.add-project-btn');
                    const newTab = document.createElement('button');
                    newTab.className = 'tab';
                    newTab.dataset.project = newProjectId;
                    newTab.innerHTML = `<span class="remove-tab" onclick="removeProject(${newProjectId}, event)">âœ–</span>${project.name}`;
                    newTab.onclick = function() { switchProject(newProjectId); };
                    tabsContainer.insertBefore(newTab, addBtn);

                    const mainContainer = document.querySelector('.container');
                    const projectContent = document.querySelector('.project-content').cloneNode(true);
                    projectContent.id = `project-${newProjectId}`;
                    projectContent.className = 'project-content';
                    projectContent.innerHTML = projectContent.innerHTML.replace(/\-0/g, `-${newProjectId}`);
                    mainContainer.appendChild(projectContent);

                    initializeProject(newProjectId);
                    switchProject(newProjectId);
                    
                    alert(`×¤×¨×•×™×§×˜ "${project.name}" × ×˜×¢×Ÿ ×‘×”×¦×œ×—×”!`);
                } catch (e) {
                    console.error('Error loading project from URL:', e);
                }
            }
        }

        function sendEmail(projectId) {
            const projectName = projects[projectId].name;
            const tableHTML = document.querySelector(`#dataTable-${projectId}`).outerHTML;
            const summaryDiv = document.getElementById(`summary-${projectId}`).outerHTML;
            const financialDiv = document.querySelector(`#project-${projectId} .financial-summary`).outerHTML;

            const emailBody = `
                <html dir="rtl">
                <head><style>
                    table { border-collapse: collapse; width: 100%; }
                    th, td { border: 1px solid #ddd; padding: 8px; text-align: right; }
                    th { background-color: #667eea; color: white; }
                </style></head>
                <body>
                    <h1>×™×•××Ÿ ×¤×¨×•×™×§×˜: ${projectName}</h1>
                    ${tableHTML}
                    <br><br>
                    ${summaryDiv}
                    <br><br>
                    ${financialDiv}
                </body>
                </html>
            `;

            const blob = new Blob([emailBody], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${projectName}_report.html`;
            a.click();

            alert('×§×•×‘×¥ ×“×•×— × ×•×¦×¨ ×œ×”×•×¨×“×”. × ×™×ª×Ÿ ×œ×©×œ×•×— ××•×ª×• ×‘××™×™×œ');
        }

        function saveToLocalStorage() {
            localStorage.setItem('projectsData', JSON.stringify(projects));
            localStorage.setItem('projectCounter', projectCounter);
        }

        function loadFromLocalStorage() {
            const savedData = localStorage.getItem('projectsData');
            const savedCounter = localStorage.getItem('projectCounter');
            
            if (savedData) {
                projects = JSON.parse(savedData);
                projectCounter = parseInt(savedCounter) || 1;

                // Rebuild tabs and content for all projects except 0
                const tabsContainer = document.getElementById('projectTabs');
                const addBtn = tabsContainer.querySelector('.add-project-btn');
                
                for (const [projectId, project] of Object.entries(projects)) {
                    if (projectId == 0) {
                        initializeProject(0);
                        continue;
                    }

                    // Add tab
                    const newTab = document.createElement('button');
                    newTab.className = 'tab';
                    newTab.dataset.project = projectId;
                    newTab.innerHTML = `<span class="remove-tab" onclick="removeProject(${projectId}, event)">âœ–</span>${project.name}`;
                    newTab.onclick = function() { switchProject(parseInt(projectId)); };
                    tabsContainer.insertBefore(newTab, addBtn);

                    // Create project content
                    const mainContainer = document.querySelector('.container');
                    const projectContent = document.querySelector('.project-content').cloneNode(true);
                    projectContent.id = `project-${projectId}`;
                    projectContent.className = 'project-content';
                    projectContent.innerHTML = projectContent.innerHTML.replace(/\-0/g, `-${projectId}`);
                    mainContainer.appendChild(projectContent);

                    initializeProject(parseInt(projectId));
                }
            }
        }

        // Planning Resources Functions
        function addPlanningResource(projectId) {
            const nameInput = document.getElementById(`planningResourceName-${projectId}`);
            const costInput = document.getElementById(`planningResourceCost-${projectId}`);
            
            const name = nameInput.value.trim();
            const cost = parseFloat(costInput.value);

            if (!name || isNaN(cost) || cost < 0) {
                alert('× × ×œ××œ× ×©× ××©××‘ ×•×¢×œ×•×ª ×ª×§×™× ×”');
                return;
            }

            if (!projects[projectId].planningResources) {
                projects[projectId].planningResources = {};
            }

            projects[projectId].planningResources[name] = cost;
            nameInput.value = '';
            costInput.value = '';
            
            updatePlanningResourceList(projectId);
            updatePlanningCalculations(projectId);
            saveToLocalStorage();
        }

        function updatePlanningResourceList(projectId) {
            const container = document.getElementById(`planningResourceList-${projectId}`);
            if (!container) return;
            
            container.innerHTML = '';
            
            if (!projects[projectId].planningResources) {
                projects[projectId].planningResources = {};
            }
            
            for (const [name, cost] of Object.entries(projects[projectId].planningResources)) {
                const div = document.createElement('div');
                div.className = 'resource-item';
                div.innerHTML = `
                    <strong>${name}</strong>
                    <div>
                        <input type="number" value="${cost}" step="0.01" 
                               onchange="updatePlanningResourceCost(${projectId}, '${name}', this.value)">
                        <span> â‚ª/×™×•×</span>
                        <button onclick="removePlanningResource(${projectId}, '${name}')">ğŸ—‘ï¸</button>
                    </div>
                `;
                container.appendChild(div);
            }
        }

        function updatePlanningResourceCost(projectId, resourceName, newCost) {
            projects[projectId].planningResources[resourceName] = parseFloat(newCost);
            updatePlanningCalculations(projectId);
            saveToLocalStorage();
        }

        function removePlanningResource(projectId, resourceName) {
            if (confirm(`×”×× ×œ××—×•×§ ××ª ×”××©××‘ "${resourceName}"?`)) {
                delete projects[projectId].planningResources[resourceName];
                updatePlanningResourceList(projectId);
                updatePlanningCalculations(projectId);
                saveToLocalStorage();
            }
        }

        function updatePlanningCalculations(projectId) {
            const daysInput = document.getElementById(`plannedDays-${projectId}`);
            const hoursPerDayInput = document.getElementById(`plannedHoursPerDay-${projectId}`);
            const hourlyRateInput = document.getElementById(`plannedHourlyRate-${projectId}`);
            
            if (!daysInput || !hoursPerDayInput || !hourlyRateInput) return;

            const days = parseFloat(daysInput.value) || 0;
            const hoursPerDay = parseFloat(hoursPerDayInput.value) || 10;
            const hourlyRate = parseFloat(hourlyRateInput.value) || 0;
            
            const totalHours = days * hoursPerDay;
            
            let resourceCost = 0;
            if (projects[projectId].planningResources) {
                for (const cost of Object.values(projects[projectId].planningResources)) {
                    resourceCost += cost * days;
                }
            }
            
            const laborCost = totalHours * hourlyRate;
            const totalCost = laborCost + resourceCost;
            
            document.getElementById(`plannedTotalDays-${projectId}`).textContent = days;
            document.getElementById(`plannedTotalHours-${projectId}`).textContent = totalHours.toFixed(1);
            document.getElementById(`plannedResourceCost-${projectId}`).textContent = resourceCost.toFixed(2);
            document.getElementById(`plannedTotalCost-${projectId}`).textContent = totalCost.toFixed(2);
            
            updateInvestmentSummary(projectId);
        }

        function updateInvestmentSummary(projectId) {
            const previousAmount = parseFloat(document.getElementById(`previousReportAmount-${projectId}`)?.value) || 0;
            const plannedCostEl = document.getElementById(`plannedTotalCost-${projectId}`);
            const newInvestment = parseFloat(plannedCostEl?.textContent) || 0;
            
            const totalInvestment = previousAmount + newInvestment;
            
            const prevInvEl = document.getElementById(`previousInvestments-${projectId}`);
            const newInvEl = document.getElementById(`newInvestmentForecast-${projectId}`);
            const totalInvEl = document.getElementById(`totalProjectInvestment-${projectId}`);
            
            if (prevInvEl) prevInvEl.textContent = previousAmount.toFixed(2);
            if (newInvEl) newInvEl.textContent = newInvestment.toFixed(2);
            if (totalInvEl) totalInvEl.textContent = totalInvestment.toFixed(2);
            
            updateRevenueCalculations(projectId);
        }

        // Software Management
        function addSoftware(projectId) {
            const nameInput = document.getElementById(`softwareName-${projectId}`);
            const costInput = document.getElementById(`softwareCost-${projectId}`);
            
            const name = nameInput.value.trim();
            const cost = parseFloat(costInput.value);

            if (!name || isNaN(cost) || cost < 0) {
                alert('× × ×œ××œ× ×©× ×ª×•×›× ×” ×•×¢×œ×•×ª ×ª×§×™× ×”');
                return;
            }

            if (!projects[projectId].softwareList) {
                projects[projectId].softwareList = [];
            }

            projects[projectId].softwareList.push({ name, cost });
            nameInput.value = '';
            costInput.value = '';
            
            renderSoftwareList(projectId);
            updateMaintenanceCosts(projectId);
            saveToLocalStorage();
        }

        function renderSoftwareList(projectId) {
            const container = document.getElementById(`softwareList-${projectId}`);
            if (!container) return;
            
            container.innerHTML = '';
            
            if (!projects[projectId].softwareList) {
                projects[projectId].softwareList = [];
            }
            
            projects[projectId].softwareList.forEach((software, index) => {
                const div = document.createElement('div');
                div.className = 'resource-item';
                div.innerHTML = `
                    <strong>${software.name}</strong>
                    <div>
                        <input type="number" value="${software.cost}" step="0.01" 
                               onchange="updateSoftwareCost(${projectId}, ${index}, this.value)">
                        <span> â‚ª/×—×•×“×©</span>
                        <button onclick="removeSoftware(${projectId}, ${index})">ğŸ—‘ï¸</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function updateSoftwareCost(projectId, index, newCost) {
            projects[projectId].softwareList[index].cost = parseFloat(newCost);
            updateMaintenanceCosts(projectId);
            saveToLocalStorage();
        }

        function removeSoftware(projectId, index) {
            if (confirm('×”×× ×œ××—×•×§ ×ª×•×›× ×” ×–×•?')) {
                projects[projectId].softwareList.splice(index, 1);
                renderSoftwareList(projectId);
                updateMaintenanceCosts(projectId);
                saveToLocalStorage();
            }
        }

        // Misc Costs Management
        function addMiscCost(projectId) {
            const nameInput = document.getElementById(`miscCostName-${projectId}`);
            const amountInput = document.getElementById(`miscCostAmount-${projectId}`);
            
            const name = nameInput.value.trim();
            const amount = parseFloat(amountInput.value);

            if (!name || isNaN(amount) || amount < 0) {
                alert('× × ×œ××œ× ×ª×™××•×¨ ×•×¡×›×•× ×ª×§×™×Ÿ');
                return;
            }

            if (!projects[projectId].miscCosts) {
                projects[projectId].miscCosts = [];
            }

            projects[projectId].miscCosts.push({ name, amount });
            nameInput.value = '';
            amountInput.value = '';
            
            renderMiscCosts(projectId);
            updateMaintenanceCosts(projectId);
            saveToLocalStorage();
        }

        function renderMiscCosts(projectId) {
            const container = document.getElementById(`miscCostsList-${projectId}`);
            if (!container) return;
            
            container.innerHTML = '';
            
            if (!projects[projectId].miscCosts) {
                projects[projectId].miscCosts = [];
            }
            
            projects[projectId].miscCosts.forEach((cost, index) => {
                const div = document.createElement('div');
                div.className = 'resource-item';
                div.innerHTML = `
                    <strong>${cost.name}</strong>
                    <div>
                        <input type="number" value="${cost.amount}" step="0.01" 
                               onchange="updateMiscCost(${projectId}, ${index}, this.value)">
                        <span> â‚ª/×—×•×“×©</span>
                        <button onclick="removeMiscCost(${projectId}, ${index})">ğŸ—‘ï¸</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function updateMiscCost(projectId, index, newAmount) {
            projects[projectId].miscCosts[index].amount = parseFloat(newAmount);
            updateMaintenanceCosts(projectId);
            saveToLocalStorage();
        }

        function removeMiscCost(projectId, index) {
            if (confirm('×”×× ×œ××—×•×§ ×¢×œ×•×ª ×–×•?')) {
                projects[projectId].miscCosts.splice(index, 1);
                renderMiscCosts(projectId);
                updateMaintenanceCosts(projectId);
                saveToLocalStorage();
            }
        }

        // Token Cost Calculator Functions
        function calculateTokenCosts(projectId) {
            const tokensPerSearch = parseFloat(document.getElementById(`tokensPerSearch-${projectId}`)?.value) || 5000;
            const tokenPricePer1k = parseFloat(document.getElementById(`tokenPricePer1k-${projectId}`)?.value) || 0.003;
            const usdToIls = parseFloat(document.getElementById(`usdToIls-${projectId}`)?.value) || 3.7;
            const numTherapists = parseFloat(document.getElementById(`numTherapists-${projectId}`)?.value) || 0;
            const treatmentsPerDay = parseFloat(document.getElementById(`treatmentsPerDay-${projectId}`)?.value) || 0;
            const tokensPerTreatment = parseFloat(document.getElementById(`tokensPerTreatment-${projectId}`)?.value) || 10000;
            const dailySearches = parseFloat(document.getElementById(`dailySearches-${projectId}`)?.value) || 0;
            const monthlyWorkDays = parseFloat(document.getElementById(`monthlyWorkDays-${projectId}`)?.value) || 22;

            // Calculate cost per treatment
            const costPerTreatmentUsd = (tokensPerTreatment / 1000) * tokenPricePer1k;
            const costPerTreatmentIls = costPerTreatmentUsd * usdToIls;

            // Calculate cost per search
            const costPerSearchUsd = (tokensPerSearch / 1000) * tokenPricePer1k;
            const costPerSearchIls = costPerSearchUsd * usdToIls;

            // Daily calculations
            const dailyTreatments = numTherapists * treatmentsPerDay;
            const dailyTreatmentTokens = dailyTreatments * tokensPerTreatment;
            const dailySearchTokens = dailySearches * tokensPerSearch;
            const dailyTotalTokens = dailyTreatmentTokens + dailySearchTokens;
            
            const dailyTokenCost = (dailyTreatments * costPerTreatmentIls) + (dailySearches * costPerSearchIls);

            // Monthly calculations
            const monthlyTokenCost = dailyTokenCost * monthlyWorkDays;

            // Update display
            document.getElementById(`costPerTreatment-${projectId}`).textContent = costPerTreatmentIls.toFixed(4);
            document.getElementById(`costPerSearch-${projectId}`).textContent = costPerSearchIls.toFixed(4);
            document.getElementById(`dailyTotalTokens-${projectId}`).textContent = dailyTotalTokens.toLocaleString();
            document.getElementById(`dailyTokenCost-${projectId}`).textContent = dailyTokenCost.toFixed(2);
            document.getElementById(`monthlyTokenCost-${projectId}`).textContent = monthlyTokenCost.toFixed(2);

            // Update the token cost input in maintenance section
            const tokenCostInput = document.getElementById(`tokenCost-${projectId}`);
            if (tokenCostInput) {
                tokenCostInput.value = monthlyTokenCost.toFixed(2);
            }

            // Update ROI input
            const avgTokenCostInput = document.getElementById(`avgTokenCostInput-${projectId}`);
            if (avgTokenCostInput) {
                avgTokenCostInput.value = monthlyTokenCost.toFixed(2);
            }

            calculateTokenRecommendation(projectId);
            calculateClientROI(projectId);
            updateMaintenanceCosts(projectId);
        }

        // === Export for NotebookLM ===
        function exportForNotebookLM(projectId) {
            const projectName = projects[projectId].name || 'project';
            const tableEl = document.querySelector(`#dataTable-${projectId}`);
            const summaryEl = document.getElementById(`summary-${projectId}`);

            let tableHTML = tableEl ? tableEl.outerHTML : '<p>××™×Ÿ × ×ª×•× ×™ ×˜×‘×œ×”</p>';
            let summaryHTML = summaryEl ? summaryEl.outerHTML : '<p>××™×Ÿ × ×ª×•× ×™ ×¡×™×›×•×</p>';

            const now = new Date();
            const timestamp = now.getFullYear() + '' +
                String(now.getMonth() + 1).padStart(2, '0') +
                String(now.getDate()).padStart(2, '0') + '_' +
                String(now.getHours()).padStart(2, '0') +
                String(now.getMinutes()).padStart(2, '0');

            const htmlContent = `<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<title>NotebookLM Export - ${projectName}</title>
</head>
<body>
<h1>×™×•××Ÿ ×¤×¨×•×™×§×˜: ${projectName}</h1>
<h2>×˜×‘×œ×ª × ×ª×•× ×™×</h2>
${tableHTML}
<h2>×¡×™×›×•×</h2>
${summaryHTML}
<p><small>×™×•×¦× ×‘×ª××¨×™×š: ${now.toLocaleString('he-IL')}</small></p>
</body>
</html>`;

            const safeName = projectName.replace(/\s+/g, '_');
            const fileName = `NotebookLM_${safeName}_${timestamp}.html`;

            const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            a.click();
            URL.revokeObjectURL(url);

            alert(`×§×•×‘×¥ NotebookLM × ×•×¦×¨: ${fileName}\n× ×™×ª×Ÿ ×œ×™×™×‘× ××•×ª×• ×™×©×™×¨×•×ª ×œ-NotebookLM.`);
        }

        // === Report History Functions ===
        function addReportToHistory(filename) {
            const now = new Date();
            const dateStr = now.toLocaleString('he-IL');
            savedReports.push({ filename, date: dateStr, timestamp: now.getTime() });
            localStorage.setItem('savedReports', JSON.stringify(savedReports));
            renderReportHistory();
        }

        function renderReportHistory() {
            const tbody = document.getElementById('reportHistoryBody');
            if (!tbody) return;
            tbody.innerHTML = '';

            if (savedReports.length === 0) {
                const row = tbody.insertRow();
                row.innerHTML = '<td colspan="3" style="text-align:center;color:#999;">××™×Ÿ ×“×•×—×•×ª ×©× ×©××¨×• ×¢×“×™×™×Ÿ</td>';
                return;
            }

            const sorted = [...savedReports].reverse();
            sorted.forEach((report, idx) => {
                const realIdx = savedReports.length - 1 - idx;
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${report.filename}</td>
                    <td>${report.date}</td>
                    <td><button class="delete-btn" onclick="removeReportFromHistory(${realIdx})">ğŸ—‘ï¸ ××—×§</button></td>
                `;
            });
        }

        function removeReportFromHistory(index) {
            if (confirm('×”×× ×œ××—×•×§ ×¨×©×•××” ×–×• ××”×”×™×¡×˜×•×¨×™×”?')) {
                savedReports.splice(index, 1);
                localStorage.setItem('savedReports', JSON.stringify(savedReports));
                renderReportHistory();
            }
        }

        function loadReportFromFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(ev) {
                    try {
                        const data = JSON.parse(ev.target.result);
                        if (data.name && data.entries) {
                            projects[0] = data;
                        } else {
                            for (const key in data) {
                                projects[key] = data[key];
                            }
                        }
                        saveToLocalStorage();
                        alert('×”×“×•×— × ×˜×¢×Ÿ ×‘×”×¦×œ×—×”! ×”×“×£ ×™×˜×¢×Ÿ ××—×“×©...');
                        location.reload();
                    } catch (err) {
                        alert('×©×’×™××” ×‘×˜×¢×™× ×ª ×”×§×•×‘×¥: ' + err.message);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function calculateTokenRecommendation(projectId) {
            const subscriptionPriceUsd = parseFloat(document.getElementById(`subscriptionPriceUsd-${projectId}`)?.value) || 8;
            const usdToIls = parseFloat(document.getElementById(`usdToIls-${projectId}`)?.value) || 3.7;
            const tokenPricePer1k = parseFloat(document.getElementById(`tokenPricePer1k-${projectId}`)?.value) || 0.003;
            const tokensPerTreatment = parseFloat(document.getElementById(`tokensPerTreatment-${projectId}`)?.value) || 10000;
            const monthlyWorkDays = parseFloat(document.getElementById(`monthlyWorkDays-${projectId}`)?.value) || 22;

            const subscriptionPriceIls = subscriptionPriceUsd * usdToIls;
            
            // Target: 30% profit margin minimum
            const targetCostRatio = 0.7; // 70% of revenue can go to costs
            const maxTokenCostPerSubscriber = subscriptionPriceIls * targetCostRatio;
            
            // Calculate how many tokens this budget allows
            const tokenCostPer1kIls = tokenPricePer1k * usdToIls;
            const recommendedMonthlyTokens = Math.floor((maxTokenCostPerSubscriber / tokenCostPer1kIls) * 1000);
            
            // Calculate how many treatments this allows
            const recommendedTreatments = Math.floor(recommendedMonthlyTokens / tokensPerTreatment);
            
            // Calculate actual profit
            const actualTokenCost = (recommendedMonthlyTokens / 1000) * tokenCostPer1kIls;
            const profitPerSubscriber = subscriptionPriceIls - actualTokenCost;
            const profitMargin = ((profitPerSubscriber / subscriptionPriceIls) * 100);

            // Update display
            document.getElementById(`recommendedMonthlyTokens-${projectId}`).textContent = recommendedMonthlyTokens.toLocaleString();
            document.getElementById(`recommendedTreatments-${projectId}`).textContent = recommendedTreatments;
            document.getElementById(`profitPerSubscriber-${projectId}`).textContent = profitPerSubscriber.toFixed(2);
            document.getElementById(`profitMargin-${projectId}`).textContent = profitMargin.toFixed(1) + '%';

            // Generate AI recommendation text
            const treatmentsPerDay = Math.ceil(recommendedTreatments / monthlyWorkDays);
            let recommendation = `ğŸ’¡ <strong>×”××œ×¦×”:</strong><br>`;
            recommendation += `×‘××—×™×¨ ×× ×•×™ ×©×œ $${subscriptionPriceUsd} (${subscriptionPriceIls.toFixed(2)} â‚ª), ××•××œ×¥ ×œ×”×’×‘×™×œ ×›×œ ××˜×¤×œ ×œ-<strong>${recommendedMonthlyTokens.toLocaleString()} ×˜×•×§× ×™× ×œ×—×•×“×©</strong>.<br>`;
            recommendation += `×–×” ×××¤×©×¨ ×›-<strong>${recommendedTreatments} ×˜×™×¤×•×œ×™× ×œ×—×•×“×©</strong> (×›-${treatmentsPerDay} ×˜×™×¤×•×œ×™× ×œ×™×•× ×¢×‘×•×“×”).<br>`;
            recommendation += `×¨×•×•×— × ×˜×•: <strong>${profitPerSubscriber.toFixed(2)} â‚ª</strong> ×œ××˜×¤×œ (${profitMargin.toFixed(1)}% ×¨×•×•×—×™×•×ª).`;
            
            if (profitMargin < 20) {
                recommendation += `<br>âš ï¸ <strong>××–×”×¨×”:</strong> ×©×•×œ×™ ×¨×•×•×— × ××•×›×™× - ×©×§×•×œ ×œ×”×¢×œ×•×ª ××—×™×¨ ××• ×œ×”×¤×—×™×ª ×˜×•×§× ×™×.`;
            } else if (profitMargin > 50) {
                recommendation += `<br>âœ… <strong>××¦×•×™×Ÿ!</strong> ×©×•×œ×™ ×¨×•×•×— ×’×‘×•×”×™× - ×™×© ××§×•× ×œ×”×’×“×™×œ ×›××•×ª ×˜×•×§× ×™× ××• ×œ×”×•×¨×™×“ ××—×™×¨.`;
            }

            document.getElementById(`aiRecommendation-${projectId}`).innerHTML = recommendation;
        }

        function calculateClientROI(projectId) {
            const fixedCosts = parseFloat(document.getElementById(`fixedMonthlyCosts-${projectId}`)?.value) || 0;
            const tokenCosts = parseFloat(document.getElementById(`avgTokenCostInput-${projectId}`)?.value) || 0;
            const subscribers = parseFloat(document.getElementById(`estimatedSubscribers-${projectId}`)?.value) || 0;
            const revenue = parseFloat(document.getElementById(`monthlySubscriptionRevenue-${projectId}`)?.value) || 0;

            const totalCosts = fixedCosts + tokenCosts;
            const netProfit = revenue - totalCosts;

            document.getElementById(`roiTotalRevenue-${projectId}`).textContent = revenue.toFixed(2) + ' â‚ª';
            document.getElementById(`roiFixedCosts-${projectId}`).textContent = fixedCosts.toFixed(2) + ' â‚ª';
            document.getElementById(`roiTokenCosts-${projectId}`).textContent = tokenCosts.toFixed(2) + ' â‚ª';
            document.getElementById(`roiNetProfit-${projectId}`).textContent = netProfit.toFixed(2) + ' â‚ª';

            // Calculate payback period
            const totalInvestmentEl = document.getElementById(`totalProjectInvestment-${projectId}`);
            const totalInvestment = parseFloat(totalInvestmentEl?.textContent) || 0;

            const paybackMonthsEl = document.getElementById(`roiPaybackMonths-${projectId}`);
            if (netProfit > 0 && totalInvestment > 0) {
                const months = Math.ceil(totalInvestment / netProfit);
                paybackMonthsEl.textContent = months + ' ×—×•×“×©×™×';
            } else {
                paybackMonthsEl.textContent = '- ×—×•×“×©×™×';
            }
        }

        function updateMaintenanceCosts(projectId) {
            const hostingCost = parseFloat(document.getElementById(`hostingCost-${projectId}`)?.value) || 0;
            const tokenCost = parseFloat(document.getElementById(`tokenCost-${projectId}`)?.value) || 0;
            const maintenanceHours = parseFloat(document.getElementById(`maintenanceHours-${projectId}`)?.value) || 0;
            const programmerRate = parseFloat(document.getElementById(`programmerRate-${projectId}`)?.value) || 0;
            const paymentFees = parseFloat(document.getElementById(`paymentFees-${projectId}`)?.value) || 0;
            const otherFixedCosts = parseFloat(document.getElementById(`otherFixedCosts-${projectId}`)?.value) || 0;
            
            let softwareCosts = 0;
            if (projects[projectId].softwareList) {
                projects[projectId].softwareList.forEach(software => {
                    softwareCosts += software.cost;
                });
            }
            
            let miscCostsTotal = 0;
            if (projects[projectId].miscCosts) {
                projects[projectId].miscCosts.forEach(cost => {
                    miscCostsTotal += cost.amount;
                });
            }
            
            const maintenanceLaborCost = maintenanceHours * programmerRate;
            const totalMonthlyCosts = hostingCost + tokenCost + maintenanceLaborCost + paymentFees + softwareCosts + miscCostsTotal + otherFixedCosts;
            
            const totalCostEl = document.getElementById(`totalMonthlyCosts-${projectId}`);
            if (totalCostEl) {
                totalCostEl.textContent = totalMonthlyCosts.toFixed(2);
            }
            
            updateRevenueCalculations(projectId);
        }

        function updateRevenueCalculations(projectId) {
            const subscribers = parseFloat(document.getElementById(`monthlySubscribers-${projectId}`)?.value) || 0;
            const subscriptionPrice = parseFloat(document.getElementById(`subscriptionPrice-${projectId}`)?.value) || 0;
            const additionalRevenue = parseFloat(document.getElementById(`additionalRevenue-${projectId}`)?.value) || 0;
            
            const totalRevenue = (subscribers * subscriptionPrice) + additionalRevenue;
            
            const totalRevenueEl = document.getElementById(`totalMonthlyRevenue-${projectId}`);
            if (totalRevenueEl) {
                totalRevenueEl.textContent = totalRevenue.toFixed(2);
            }
            
            // Final profit/loss calculations
            const totalCostEl = document.getElementById(`totalMonthlyCosts-${projectId}`);
            const totalCosts = parseFloat(totalCostEl?.textContent) || 0;
            
            const profitLoss = totalRevenue - totalCosts;
            
            const finalRevenueEl = document.getElementById(`finalMonthlyRevenue-${projectId}`);
            const finalCostsEl = document.getElementById(`finalMonthlyCosts-${projectId}`);
            const profitLossEl = document.getElementById(`monthlyProfitLoss-${projectId}`);
            const profitLossLabel = document.getElementById(`profitLossLabel-${projectId}`);
            
            if (finalRevenueEl) finalRevenueEl.textContent = totalRevenue.toFixed(2) + ' â‚ª';
            if (finalCostsEl) finalCostsEl.textContent = totalCosts.toFixed(2) + ' â‚ª';
            if (profitLossEl) {
                profitLossEl.textContent = profitLoss.toFixed(2) + ' â‚ª';
                profitLossEl.style.color = profitLoss >= 0 ? '#4CAF50' : '#ff4444';
            }
            if (profitLossLabel) {
                profitLossLabel.textContent = profitLoss >= 0 ? 'ğŸ’µ ×¨×•×•×— ×—×•×“×©×™' : 'âš ï¸ ×”×¤×¡×“ ×—×•×“×©×™';
            }
            
            // ROI calculation
            const totalInvestmentEl = document.getElementById(`totalProjectInvestment-${projectId}`);
            const totalInvestment = parseFloat(totalInvestmentEl?.textContent) || 0;
            
            const roiMonthsEl = document.getElementById(`roiMonths-${projectId}`);
            if (roiMonthsEl && profitLoss > 0) {
                const months = Math.ceil(totalInvestment / profitLoss);
                roiMonthsEl.textContent = months + ' ×—×•×“×©×™×';
            } else if (roiMonthsEl) {
                roiMonthsEl.textContent = '- ×—×•×“×©×™×';
            }
            
            // Minimum subscribers recommendation
            const minSubscribersEl = document.getElementById(`minSubscribersRecommendation-${projectId}`);
            if (minSubscribersEl && subscriptionPrice > 0) {
                const minSubscribers = Math.ceil(totalCosts / subscriptionPrice);
                minSubscribersEl.textContent = minSubscribers;
            } else if (minSubscribersEl) {
                minSubscribersEl.textContent = '0';
            }
        }
    </script>
</body>
</html>

